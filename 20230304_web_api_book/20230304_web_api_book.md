# 「Web API The Good Parts」のブログ要点

## リクエストとエンドポイント関連

主に2章の内容. 


### URI を見て機能がひと目でわかる

2.2.1

結局使用するのは人間なので. 


### URI に大文字小文字が混ざっていない

基本はすべて小文字を使用する. ホスト名が大文字小文字を無視するため, 
通常は小文字で表記する.  足並み揃える.


### URI でなんとなく使い方の想像がつく

* ドキュメントとかいちいち見たくない
    * `http://example.com/v1/user/123` だったらユーザー123を取得する

### エンドポイントには複数形の名詞

* 2.4.1.1
* users, friends, updates など
* 集合を表しているものは複数形のほうが適切であるという考え
* そもそもなぜ名詞なのか？
    * URIがそもそもリソースを表すものであるため
    * そして HTTP のメソッドが動詞を表す


### エンドポイントの単語のつなぎは「ハイフン」

* 2.4.4

* 区切り候補
    * キャメルケース
    * スネークケース
    * スパイナルケース
* Google がハイフンを推奨しており SEO 的によい
* アンダースコアだとリンクアドレスに下線が引かれて重なって見づらい
* URI のホスト部はハイフンは許可されているがアンダースコアは使えず、大文字小文字の区別がないためホスト部とルールを統一するとハイフンとなる
* 実際のところ最も良いのは極力単語をつなげることを避ける
    * パスで区切る
    * 短い表現を目指す
    * クエリパラメータにする
* しかし割と好みなので、別にアンスコ、キャメルケースでもよい

### 一括取得系は絞り込みも対応

* 2.5
* GET: /users/ とか
* クエリパラメータで指定する

量多いので後回し

### クエリパラメータとパスの使い分け

2.5.5

パラメータをクエリパラメータにするかパスに入れるかの使い分け. 
判断基準は以下. 

① 一意なリソースを表すのに必要な情報かどうか

URI がそもそもリソースを表すものであるため, 参照したい情報が一意に決まる場合はパスにしたほうがよい.


② 省略しても良いようなパラメータはクエリにする


### メソッド

* PUT
    * 2.3.3
    * リソースを完全上書き
    *  送信するデータでもともとのリソースを完全に上書きする
* PATCH
    * 2.3.5
    * リソースの一部を修正

### エンドポイント共通部分にバージョンを付与する

2.7

`http://example.com/v1/xxx`

バージョンの付け方については5.2.2等も参照


## レスポンス関連

### レスポンスの内容をユーザーが選べるようにする

3.3.1

ユーザーがほしい情報だけを選べるような作りにする. (名前がほしいだけなら名前だけとか)
データサイズ的にも無駄になってしまう.

クエリパラメータで指定できるようにする. 

```
http://example.com/v1/users/123?fields=name,age
```

### レスポンスデータは配列ではなくなるべくオブジェクト？

3.3.4

レスポンスデータはオブジェクトに統一するほうがややオススメ. 

* レスポンスデータが何を示しているのかわかりやすくなる
* レスポンスデータをオブジェクトに統一できる
    * クライアント側で処理を共通化できる
* JSONインジェンクションのリスクが軽減する

読み込んだJSONファイルがオブジェクトの場合, トップレベルにブレースがきて
JavaScriptの構文としておかしいためJSONインジェクションを防ぐ可能性がやや上がる. 

### 単/複数形に気をつける

データが複数(配列)になる可能性があるなら「複数形」, 1つだけなら単数形というかたちできちんと使い分ける. 

3.4.1

### 日付はRFC3339を使用する

3.4.3

2015-10-15T11:30:22+09:00

* 数ある日時を表すフォーマットの問題を解決
* 読みやすく使いやすいを目指したインターネット上で用いる標準形式
* 冗長な表現もない
    * 日付と曜日両方を含むなど

ただし, HTTPヘッダの Date や Expires などには使用できない...

### エラー時のステータスコードは適切に

3.6.1

ちゃんとステータスコードでエラーの状態を示す.
リクエストが成功していないのに200番台を返すなどはしない.

クライアントライブラリとかでステータスコードを見て処理を分岐するものなども
あるため, ちゃんと作法に従う. 


### データをエンベロープ(封筒)で包まない

3.3.2

エンベロープとはAPI的にはすべてのデータを同じ構造でくるむこと.

「HTTPの仕様をフル活用する」にも書いているがそもそもHTTPヘッダがエンベロープなので冗長になる.


## その他

### HTTPの仕様をフル活用する

4

* HTTPヘッダ
* ステータスコード
* キャッシュ
    * クライアント側にキャッシュをさせたい/させたくないなどHTTPヘッダである程度コントロールできる
    * Cache-Contorol
        * キャッシュしてほしくない場合は `no-cache`, `no-store`
    * Vary
        * URI以外にデータを一意に特定するリクエストヘッダを指定する
        * URIが同じでもVaryで指定したヘッダに変化があった場合データをとりに行く
* メディアタイプ



